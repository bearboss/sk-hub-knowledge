title: Nginx-location规则

date: 2021/5/26 11:44

tags: [Java]

categories: Java

copyright: true

sticky: 0

---

<span id="delete">

![](/images/banner/2.jpg)

</span>

<!--more-->
# 语法规则
```
= 开头表示精确匹配

^~ 开头表示uri以某个常规字符串开头，理解为匹配url路径即可(非正则)

~ 开头表示区分大小写的正则匹配

~* 开头表示不区分大小写的正则匹配

!~和!~*分别为区分大小写不匹配及不区分大小写不匹配的正则

/ 通用匹配，任何请求都会匹配到
```
# 优先级
```
等号类型（=）的优先级最高。一旦匹配成功，则不再查找其他location的匹配项

^~和通用匹配。使用前缀匹配，不支持正则表达式，如果有多个location匹配成功的话，不会终止匹配过程，会匹配表达式最长的那个(下方有例子)

如果上一步得到的最长的location为^~类型，则表示阻断正则表达式，不再匹配正则表达式

如果上一步得到的最长的location不是^~类型，继续匹配正则表达式，只要有一个正则成功，则使用这个正则的location，立即返回结果，并结束解析过程
```
# root 和 alias
```
用root属性指定的值是要加入到最终路径中的，匹配条件会拼接到路径中

用alias属性指定的值不需要加入到最终路径中
注意：alias指定的路径结尾要加”/”
```
# / 的一些规则
```
  1. proxy_pass最后面没有斜杠,匹配路径有斜杠(/bbb/)
    location /bbb/ {
        proxy_pass http://localhost:9527;
    }
    实际请求: http://localhost:9527/bbb/ - 看有无index.html
    
  2. proxy_pass最后面有斜杠 “/”，匹配路径也有斜杠(/bbb/)
    location /bbb/ {
        proxy_pass http://localhost:9527/;
    }
    实际请求: http://localhost:9527 - 将/bbb/ 丢弃
    
  3.proxy_pass后面还有其他路径但是最后没有 “/”， 匹配路径也有斜杠(/bbb/) 
    location /bbb/ {
        proxy_pass http://localhost:9527/ccc;
    }
    实际请求: http://localhost:9527/cccindex.html
    
  4.proxy_pass后面还有其他路径但是最后有 “/”， 匹配路径也有斜杠(/bbb/) 
    location /bbb/ {
        proxy_pass http://localhost:9527/ccc/;
    }
    实际请求: http://localhost:9527/ccc/index.html
    
  5.location匹配路径末尾没有 “/”，proxy_pass后面也没有”/”
    location /bbb {
        proxy_pass http://localhost:9527;
    }
    实际请求: http://localhost:9527/bbb/index.html
  6.location匹配路径末尾没有 “/”，proxy_pass后面也没有”/”,但是有子路径
    location /bbb {
        proxy_pass http://localhost:9527/ccc;
    }
    实际请求: http://localhost:9527/ccc/bbb/index.html
```

# 刷新URL 404 

```
try_files $uri $uri/ /index.html;

location / {
  root E:/xhwl-project/starlink-project/datart/frontend/static/;
  index  index.html index.htm;
  try_files $uri $uri/ /index.html;
}
```

