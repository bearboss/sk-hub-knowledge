title: 秒杀

date: 2021-05-25 15:20:37

tags: 秒杀

categories: 秒杀

copyright: true

sticky: 0

---

<span id="delete">

![](/images/banner/4.jpg)

</span>

<!--more-->

# 秒杀
## 通过redis乐观锁机制实现 

```
# 启动类
import redis.clients.jedis.Jedis;

import java.util.concurrent.LinkedBlockingDeque;
import java.util.concurrent.ThreadPoolExecutor;
import java.util.concurrent.TimeUnit;

public class Application {
    public static ThreadPoolExecutor pool=new ThreadPoolExecutor(
      10,100,10, TimeUnit.SECONDS,
      new LinkedBlockingDeque<Runnable>()
    );
    public static void main(String[] args) {
        Jedis jedis=new Jedis("localhost",6379);
        jedis.auth("abc123456");
        jedis.select(1);
        jedis.set("kill_num","50");
        jedis.del("kill_list");
        jedis.close();
        for (int i=0;i<1000;i++){
            pool.execute(new KillTask());
        }
    }
}
```

```
# 实现
import redis.clients.jedis.Jedis;
import redis.clients.jedis.Transaction;

public class KillTask implements Runnable {
    @Override
    public void run() {
        Jedis jedis=new Jedis("localhost",6379);
        jedis.auth("abc123456");
        jedis.select(1);
        jedis.watch("kill_num","kill_list"); # watch机制,如果改变了事务会终止
        int num=Integer.parseInt(jedis.get("kill_num"));
        if(num>0){
            Transaction transaction=jedis.multi(); # 放一个事务中,原子性操作
            transaction.decr("kill_num");
            transaction.rpush("kill_list","9527");
            transaction.exec();
        }
        else {
            Application.pool.shutdown();
        }
        jedis.close();
    }
}
```